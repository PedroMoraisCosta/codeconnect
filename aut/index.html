<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt">
<head>
  <meta charset="UTF-8"> 
  <meta  http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <title>Codeconnect - Ajuda</title>
  <!-- ?p1=Guilherme&p2=mendes&p3=01-03-2000&p4=minhaSuperChave123&p5=f1 -->
</head>
<body>
  <center class="wrapper">

  <div class="titleName" id="title">P1 P2</div>

  <div class="container">
    <div class="titleAbout">Sobre mim...</div>
   

    <div class="info-box">
      <div class="imgPuzzle"></div>
      <p class="titleDescription" id="titleDescription">P3</p>
      <div id="dtnascimento">
        <p class="descriptionPosition"><strong>Data de nascimento:</strong></p>
        <ul style="text-align: left; max-width: 250px; margin: auto;">
          <li><span id="dtnasc"></span></li>
        </ul>
     </div>
      <p class="descriptionPosition"><strong>Como me acalmar:</strong></p>
      <ul style="text-align: left; max-width: 250px; margin: auto;">
        <li>TelemÃ³vel com YouTube</li>
      </ul>
      <p class="descriptionPosition"><strong>MedicaÃ§Ã£o que tomo regularmente:</strong></p>
      <ul style="text-align: left; max-width: 250px; margin: auto;">
        <li></li>
      </ul>
    </div>

    <!-- BotÃµes de contacto -->
    <div class="contact-button" id="pai"><span class="contact-name">ðŸ“ž Pai</span> <span id="tel1">-</span></div>
    <div class="contact-button" id="mae"><span class="contact-name">ðŸ“ž MÃ£e</span> <span id="tel2">-</span></div>
    <div class="contact-button" id="avo"><span class="contact-name">ðŸ“ž AvÃ³</span> <span id="tel3">-</span></div>
    <div class="contact-button" id="avo2"><span class="contact-name">ðŸ“ž AvÃ´</span> <span id="tel4">-</span></div>

    <!-- Imagem de crianÃ§a com puzzle (deves substituir pela imagem real se quiseres) -->
    <!-- <img src="../aut/img/crianca.png" alt="Imagem crianÃ§a puzzle" class="child-image"> -->
    <br>
    <br>
    <div class="footer footerTamanho1">Obrigado...</div>
    <div class="footer footerTamanho2">www.codeconnect.pt</div>


  </div>
 </center>
  <script>
    function getParametroURL(nome) {
      const params = new URLSearchParams(window.location.search);
      return params.get(nome);
    }

    const pnome = getParametroURL("p1");
    const unome = getParametroURL("p2");
    const dtnasc = getParametroURL("p3");
    
    if (pnome) 
      document.getElementById("title").textContent = pnome.toUpperCase();
    if (pnome && unome)  
      document.getElementById("title").textContent = pnome.toUpperCase() +" "+ unome.toUpperCase();
    if (pnome) 
      document.getElementById("titleDescription").innerHTML = "OlÃ¡! Sou o " + pnome.toUpperCase() + " e tenho<br>dificuldade para comunicar.";
    if(dtnasc)
    {
      document.getElementById("dtnasc").textContent = dtnasc;
    }
    else{
      document.getElementById("dtnascimento").style.display = "none";
    } 
    
    document.getElementById("pai").style.display = "none";
    document.getElementById("mae").style.display = "none";
    document.getElementById("avo").style.display = "none";
    document.getElementById("avo2").style.display = "none";

    const chave = getParametroURL("p4");
    const file = getParametroURL("p5");

    if(file && chave){
      carregarContactos(file, chave);
    }
  
    
    function carregarContactos(file, chave) {
    if (!file || !chave) return;

    fetch(file + '.json')
        .then(response => response.text())
        .then(data => {
          
                const decrypted = CryptoJS.AES.decrypt(
                    data,
                    chave
                ).toString(CryptoJS.enc.Utf8);

                if (decrypted) {
                    const contatos = JSON.parse(decrypted);

                    contatos.telefones.forEach((tel, index) => {
                        const el = document.getElementById("tel" + (index + 1));
                        if (el && tel) {
                            switch (index) {
                                case 0:
                                    if (tel > 0) document.getElementById("pai").style.display = "block";
                                    break;
                                case 1:
                                    if (tel > 0) document.getElementById("mae").style.display = "block";
                                    break;
                                case 2:
                                    if (tel > 0) document.getElementById("avo").style.display = "block";
                                    break;
                                case 3:
                                    if (tel > 0) document.getElementById("avo2").style.display = "block";
                                    break;
                            }
                            el.textContent = tel;
                        }
                    });
                } 
            
        })
        .catch(error => {
            console.error("Erro ao carregar o ficheiro: ", error);
            document.body.innerHTML = "<p>Erro ao carregar o ficheiro!</p>";
        });
}


  </script>

</body>
</html>
